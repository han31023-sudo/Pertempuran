name: Build APK GeminiTube
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build Proses
        run: |
          # Install Bubblewrap secara global
          npm install -g @bubblewrap/cli
          
          # Buat file manifest otomatis (Standard PWA)
          echo '{
            "name": "GeminiTube",
            "short_name": "GeminiTube",
            "start_url": "index.html",
            "display": "standalone",
            "background_color": "#ffffff",
            "theme_color": "#000000",
            "icons": [
              {
                "src": "https://vitejs.dev/logo.svg",
                "sizes": "512x512",
                "type": "image/png"
              }
            ]
          }' > manifest.json

          # TRIK SAKTI: Menjawab otomatis semua pertanyaan (Y/n) dari Bubblewrap
          # Termasuk izin install JDK dan Android SDK di server
          yes | bubblewrap init --manifest=manifest.json
          
          # Build APK tanpa tanda tangan digital (untuk testing langsung instal)
          bubblewrap build --skip-signing

      - name: Upload Hasil APK
        uses: actions/upload-artifact@v4
        with:
          name: GeminiTube-App-Hasil
          path: "*.apk"
